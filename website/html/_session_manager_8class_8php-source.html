<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Stage: D:/developpement/php/www/Stage/trunk/class/SessionManager.class.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>D:/developpement/php/www/Stage/trunk/class/SessionManager.class.php</h1><a href="_session_manager_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 set_include_path(<span class="stringliteral">"."</span>.PATH_SEPARATOR.<span class="stringliteral">".."</span>);
<a name="l00003"></a>00003 <span class="keywordflow">if</span>(!isset($ROOT_PATH))
<a name="l00004"></a>00004 require_once(<span class="stringliteral">"inc/main.inc.php"</span>);
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">// Classe permettant de g�rer toutes les variables de sessions (pour une clart� du code)</span>
<a name="l00007"></a><a class="code" href="class_session_manager.html">00007</a> <span class="keyword">class </span><a class="code" href="class_session_manager.html">SessionManager</a> {
<a name="l00008"></a><a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">00008</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">$VARIABLE_ID_ETUDIANT</a> = <span class="stringliteral">"idEtudiant"</span>;
<a name="l00009"></a><a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">00009</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">$VARIABLE_ID_ENSEIGNANT</a> = <span class="stringliteral">"idEnseignant"</span>;
<a name="l00010"></a><a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">00010</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">$VARIABLE_ID_ADMIN</a> = <span class="stringliteral">"idAdmin"</span>;
<a name="l00011"></a><a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">00011</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">$VARIABLE_ID_SECRETAIRE</a> = <span class="stringliteral">"idSecretaire"</span>;
<a name="l00012"></a><a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">00012</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">$VARIABLE_EXPANDED_MENU</a> = <span class="stringliteral">"expandedMenu"</span>;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014     <span class="comment">// Variables pour palier au manque de HTTP_REFERER dans php5</span>
<a name="l00015"></a><a class="code" href="class_session_manager.html#478536c1fdbeab9fe65bd4636ba26a58">00015</a>     <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#478536c1fdbeab9fe65bd4636ba26a58">$VARIABLE_REFERER</a> = <span class="stringliteral">"referer"</span>;
<a name="l00016"></a><a class="code" href="class_session_manager.html#0cc057f8cd438e96007199835ea13cbd">00016</a>     <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#0cc057f8cd438e96007199835ea13cbd">$VARIABLE_URL</a> = <span class="stringliteral">"url"</span>;
<a name="l00017"></a>00017     
<a name="l00018"></a><a class="code" href="class_session_manager.html#5986ff344009e2bf603f013e4408c7da">00018</a>     <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_session_manager.html#5986ff344009e2bf603f013e4408c7da">$_sessionStarted</a> = <span class="keyword">false</span>;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="comment">//d�bute la session ou recup�re celle commenc�e avant</span>
<a name="l00021"></a><a class="code" href="class_session_manager.html#a056fc128cbf1473d296b5fd4cadde75">00021</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#a056fc128cbf1473d296b5fd4cadde75">startSession</a>(){
<a name="l00022"></a>00022         <span class="keywordflow">if</span>(!<a class="code" href="class_session_manager.html#5986ff344009e2bf603f013e4408c7da">SessionManager::$_sessionStarted</a>)
<a name="l00023"></a>00023                 session_start();
<a name="l00024"></a>00024         <a class="code" href="class_session_manager.html#5986ff344009e2bf603f013e4408c7da">SessionManager::$_sessionStarted</a> = <span class="keyword">true</span>;
<a name="l00025"></a>00025         <span class="keywordflow">if</span>(isset($_SESSION[<a class="code" href="class_session_manager.html#0cc057f8cd438e96007199835ea13cbd">SessionManager::$VARIABLE_URL</a>]))
<a name="l00026"></a>00026             $_SESSION[<a class="code" href="class_session_manager.html#478536c1fdbeab9fe65bd4636ba26a58">SessionManager::$VARIABLE_REFERER</a>] = $_SESSION[SessionManager::$VARIABLE_URL];
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         <span class="comment">// Construction de l'url du script actuel</span>
<a name="l00029"></a>00029         $scriptName = $_SERVER[<span class="stringliteral">"SCRIPT_FILENAME"</span>];
<a name="l00030"></a>00030         $rootPath = $GLOBALS['ROOT_PATH'];
<a name="l00031"></a>00031         <span class="comment">// On supprime le root path du script name</span>
<a name="l00032"></a>00032         $scriptName = substr($scriptName, strlen($rootPath)+(($scriptName[strlen($rootPath)]!=<span class="charliteral">'/'</span>)?1:0));
<a name="l00033"></a>00033         $_SESSION[SessionManager::$VARIABLE_URL] = $GLOBALS['URL_ROOT_PATH'].$scriptName.<span class="stringliteral">"?"</span>;
<a name="l00034"></a>00034         <span class="keywordflow">return</span> NULL;
<a name="l00035"></a>00035         <span class="comment">// On "colle" toutes les variables en get</span>
<a name="l00036"></a>00036         foreach($_GET as $key =&gt; $value)
<a name="l00037"></a>00037             $_SESSION[SessionManager::$VARIABLE_URL] .= $key.<span class="stringliteral">"="</span>.$value.<span class="stringliteral">"&amp;"</span>;
<a name="l00038"></a>00038     }
<a name="l00039"></a><a class="code" href="class_session_manager.html#3ef68144d821bcac729c05a03610fd69">00039</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#3ef68144d821bcac729c05a03610fd69">isSomeoneLogged</a>(){
<a name="l00040"></a>00040         <span class="keywordflow">return</span> (<a class="code" href="class_session_manager.html#695b17284351992f16e6376d6619f89a">SessionManager::isEtudiantLogged</a>() || <a class="code" href="class_session_manager.html#95ba08b23abdafdab3951fcb46f13307">SessionManager::isEnseignantLogged</a>() || <a class="code" href="class_session_manager.html#097ace391a562a449f91852bb389813a">SessionManager::isAdminLogged</a>() || <a class="code" href="class_session_manager.html#70a7d655c69f2924487a687cd3e724db">SessionManager::isSecretaireLogged</a>());
<a name="l00041"></a>00041         }
<a name="l00042"></a><a class="code" href="class_session_manager.html#695b17284351992f16e6376d6619f89a">00042</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#695b17284351992f16e6376d6619f89a">isEtudiantLogged</a>(){
<a name="l00043"></a>00043                 <span class="keywordflow">return</span> (isset($_SESSION[<a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">SessionManager::$VARIABLE_ID_ETUDIANT</a>]) &amp;&amp; $_SESSION[SessionManager::$VARIABLE_ID_ETUDIANT] != <span class="stringliteral">""</span>);
<a name="l00044"></a>00044         }
<a name="l00045"></a><a class="code" href="class_session_manager.html#95ba08b23abdafdab3951fcb46f13307">00045</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#95ba08b23abdafdab3951fcb46f13307">isEnseignantLogged</a>(){
<a name="l00046"></a>00046                 <span class="keywordflow">return</span> (isset($_SESSION[<a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">SessionManager::$VARIABLE_ID_ENSEIGNANT</a>]) &amp;&amp; $_SESSION[SessionManager::$VARIABLE_ID_ENSEIGNANT] != <span class="stringliteral">""</span>);
<a name="l00047"></a>00047         }
<a name="l00048"></a><a class="code" href="class_session_manager.html#097ace391a562a449f91852bb389813a">00048</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#097ace391a562a449f91852bb389813a">isAdminLogged</a>(){
<a name="l00049"></a>00049                 <span class="keywordflow">return</span> (isset($_SESSION[<a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">SessionManager::$VARIABLE_ID_ADMIN</a>]) &amp;&amp; $_SESSION[SessionManager::$VARIABLE_ID_ADMIN] != <span class="stringliteral">""</span>);
<a name="l00050"></a>00050         }
<a name="l00051"></a><a class="code" href="class_session_manager.html#70a7d655c69f2924487a687cd3e724db">00051</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#70a7d655c69f2924487a687cd3e724db">isSecretaireLogged</a>(){
<a name="l00052"></a>00052                 <span class="keywordflow">return</span> (isset($_SESSION[<a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">SessionManager::$VARIABLE_ID_SECRETAIRE</a>]) &amp;&amp; $_SESSION[SessionManager::$VARIABLE_ID_SECRETAIRE] != <span class="stringliteral">""</span>);
<a name="l00053"></a>00053     }
<a name="l00054"></a><a class="code" href="class_session_manager.html#2abf02f026204076f6fd13f8846b7000">00054</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#2abf02f026204076f6fd13f8846b7000">isThereMenuExpanded</a>(){
<a name="l00055"></a>00055                 <span class="keywordflow">return</span> (isset($_SESSION[<a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">SessionManager::$VARIABLE_EXPANDED_MENU</a>]) &amp;&amp; $_SESSION[SessionManager::$VARIABLE_EXPANDED_MENU] != <span class="stringliteral">""</span>);
<a name="l00056"></a>00056         }
<a name="l00057"></a><a class="code" href="class_session_manager.html#fc4f3709d64f046970fe0e1b51a74628">00057</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#fc4f3709d64f046970fe0e1b51a74628">isExpanded</a>($menu){
<a name="l00058"></a>00058                 <span class="keywordflow">return</span> ($_SESSION[<a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">SessionManager::$VARIABLE_EXPANDED_MENU</a>]==$menu);
<a name="l00059"></a>00059         }
<a name="l00060"></a><a class="code" href="class_session_manager.html#782e2317988aa39dd1504a1e83568f86">00060</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#782e2317988aa39dd1504a1e83568f86">getEtudiant</a>(){
<a name="l00061"></a>00061                 <span class="keywordflow">if</span> (<a class="code" href="class_session_manager.html#695b17284351992f16e6376d6619f89a">SessionManager::isEtudiantLogged</a>()){
<a name="l00062"></a>00062                         $etudiants = <a class="code" href="class_d_b_etudiant.html#51f3b7e1e85400824be7a2cb55315dee">DBEtudiant::getRecords</a>($_SESSION[<a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">SessionManager::$VARIABLE_ID_ETUDIANT</a>]);
<a name="l00063"></a>00063                         assert(count($etudiants)==1);
<a name="l00064"></a>00064                         <span class="keywordflow">return</span> $etudiants[0];
<a name="l00065"></a>00065                 }
<a name="l00066"></a>00066                 <span class="keywordflow">return</span> NULL;
<a name="l00067"></a>00067         }
<a name="l00068"></a><a class="code" href="class_session_manager.html#5f93f581f033db73870e8c75f188af05">00068</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#5f93f581f033db73870e8c75f188af05">getEnseignant</a>(){
<a name="l00069"></a>00069                 <span class="keywordflow">if</span> (<a class="code" href="class_session_manager.html#95ba08b23abdafdab3951fcb46f13307">SessionManager::isEnseignantLogged</a>()){
<a name="l00070"></a>00070                         $enseignants = <a class="code" href="class_d_b_enseignant.html#ef71d34e42385466cc2da38e33a1826d">DBEnseignant::getRecords</a>($_SESSION[<a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">SessionManager::$VARIABLE_ID_ENSEIGNANT</a>]);
<a name="l00071"></a>00071                         assert(count($enseignants)==1);
<a name="l00072"></a>00072                         <span class="keywordflow">return</span> $enseignants[0];
<a name="l00073"></a>00073                 }
<a name="l00074"></a>00074                 <span class="keywordflow">return</span> NULL;
<a name="l00075"></a>00075         }
<a name="l00076"></a><a class="code" href="class_session_manager.html#9a0c76e16803648704ec3a8d87cb090e">00076</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#9a0c76e16803648704ec3a8d87cb090e">getAdmin</a>(){
<a name="l00077"></a>00077                 <span class="keywordflow">if</span> (<a class="code" href="class_session_manager.html#097ace391a562a449f91852bb389813a">SessionManager::isAdminLogged</a>())
<a name="l00078"></a>00078                         <span class="keywordflow">return</span> $_SESSION[<a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">SessionManager::$VARIABLE_ID_ADMIN</a>];
<a name="l00079"></a>00079                 <span class="keywordflow">return</span> NULL;
<a name="l00080"></a>00080         }
<a name="l00081"></a><a class="code" href="class_session_manager.html#6d943ffb00ac997b214635001631b8ee">00081</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#6d943ffb00ac997b214635001631b8ee">getSecretaire</a>(){
<a name="l00082"></a>00082                 <span class="keywordflow">if</span> (<a class="code" href="class_session_manager.html#70a7d655c69f2924487a687cd3e724db">SessionManager::isSecretaireLogged</a>())
<a name="l00083"></a>00083                         <span class="keywordflow">return</span> $_SESSION[<a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">SessionManager::$VARIABLE_ID_SECRETAIRE</a>];
<a name="l00084"></a>00084                 <span class="keywordflow">return</span> NULL;
<a name="l00085"></a>00085         }
<a name="l00086"></a><a class="code" href="class_session_manager.html#07804054f60391557a7e670c48c2a8ba">00086</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#07804054f60391557a7e670c48c2a8ba">getExpandedMenu</a>(){
<a name="l00087"></a>00087                 <span class="keywordflow">if</span>(SessionManager::isThereExpandedMenu())
<a name="l00088"></a>00088                         <span class="keywordflow">return</span> $_SESSION[<a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">SessionManager::$VARIABLE_EXPANDED_MENU</a>];
<a name="l00089"></a>00089                 <span class="keywordflow">return</span> NULL;
<a name="l00090"></a>00090         }
<a name="l00091"></a><a class="code" href="class_session_manager.html#792d6430c0d5739308b8dcb0e1940abb">00091</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#792d6430c0d5739308b8dcb0e1940abb">getHTTPReferer</a>(){
<a name="l00092"></a>00092         <span class="keywordflow">if</span>(!isset($_SESSION[<a class="code" href="class_session_manager.html#478536c1fdbeab9fe65bd4636ba26a58">SessionManager::$VARIABLE_REFERER</a>]))
<a name="l00093"></a>00093             <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00094"></a>00094         <span class="keywordflow">else</span>
<a name="l00095"></a>00095             <span class="keywordflow">return</span> $_SESSION[SessionManager::$VARIABLE_REFERER];
<a name="l00096"></a>00096     }
<a name="l00097"></a><a class="code" href="class_session_manager.html#65b75e105b3ddd0a7ba9c5f39f5a6dc0">00097</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#65b75e105b3ddd0a7ba9c5f39f5a6dc0">disconnectUsers</a>(){
<a name="l00098"></a>00098         session_unregister(<a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">SessionManager::$VARIABLE_ID_ETUDIANT</a>);
<a name="l00099"></a>00099         session_unregister(<a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">SessionManager::$VARIABLE_ID_ENSEIGNANT</a>);
<a name="l00100"></a>00100         session_unregister(<a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">SessionManager::$VARIABLE_ID_ADMIN</a>);
<a name="l00101"></a>00101         session_unregister(<a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">SessionManager::$VARIABLE_ID_SECRETAIRE</a>);
<a name="l00102"></a>00102     }
<a name="l00103"></a><a class="code" href="class_session_manager.html#d293397b38f61c3c451cae44e71a9924">00103</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#d293397b38f61c3c451cae44e71a9924">registerEtudiant</a>(<a class="code" href="class_d_b_etudiant.html">DBEtudiant</a> $etudiant){
<a name="l00104"></a>00104                 $_SESSION[<a class="code" href="class_session_manager.html#42690b65082efc0c03c7bf33e8f1bb36">SessionManager::$VARIABLE_ID_ETUDIANT</a>]=$etudiant-&gt;<a class="code" href="class_d_b_etudiant.html#a53384206f7aa823a53e270a5eb56165">getIdEtudiant</a>();    
<a name="l00105"></a>00105         }
<a name="l00106"></a><a class="code" href="class_session_manager.html#480052e3987d04125c4e76f68f51a27d">00106</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#480052e3987d04125c4e76f68f51a27d">registerEnseignant</a>(<a class="code" href="class_d_b_enseignant.html">DBEnseignant</a> $enseignant){
<a name="l00107"></a>00107                 $_SESSION[<a class="code" href="class_session_manager.html#473ec5b2959d4d5e0a2035318c2caece">SessionManager::$VARIABLE_ID_ENSEIGNANT</a>]=$enseignant-&gt;<a class="code" href="class_d_b_enseignant.html#51b6e640a24219a654fd84dacf87a628">getIdEnseignant</a>();
<a name="l00108"></a>00108         }
<a name="l00109"></a><a class="code" href="class_session_manager.html#2bb0a8419e7262e66c9d337cdc592cb7">00109</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#2bb0a8419e7262e66c9d337cdc592cb7">registerAdmin</a>($login_admin){
<a name="l00110"></a>00110                 $_SESSION[<a class="code" href="class_session_manager.html#f9c7218a711d0c6b35cf0e2797274849">SessionManager::$VARIABLE_ID_ADMIN</a>]=$login_admin;
<a name="l00111"></a>00111         }
<a name="l00112"></a><a class="code" href="class_session_manager.html#256d838518d764999f693733a7c178ef">00112</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#256d838518d764999f693733a7c178ef">registerSecretaire</a>($login_secretaire){
<a name="l00113"></a>00113                 $_SESSION[<a class="code" href="class_session_manager.html#97005ea6d5f3cb5f607819914bbdb3b4">SessionManager::$VARIABLE_ID_SECRETAIRE</a>]=$login_secretaire;
<a name="l00114"></a>00114         }
<a name="l00115"></a><a class="code" href="class_session_manager.html#3fe6b0a9eefc2d33a27a3202a3f2827e">00115</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_session_manager.html#3fe6b0a9eefc2d33a27a3202a3f2827e">registerExpandedMenu</a>($menu){
<a name="l00116"></a>00116                 $_SESSION[<a class="code" href="class_session_manager.html#26893e79ab2047747c94620e7db8b47a">SessionManager::$VARIABLE_EXPANDED_MENU</a>]=$menu;
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Mar 28 11:48:06 2007 for Stage by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
